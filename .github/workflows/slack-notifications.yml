name: Slack Notifications

on:
  push:
    branches:
      - main
      - master
      - develop
      - tri
      - duy
      - bop
      - tuan
  pull_request:
    types: [opened, closed]

jobs:
  notify-slack:
    name: Gá»­i thÃ´ng bÃ¡o Ä‘áº¿n Slack
    runs-on: ubuntu-latest
    steps:
      # --- THÃ”NG BÃO MERGE VÃ€O MAIN (Giá»¯ dáº¡ng Ä‘Æ¡n giáº£n, á»•n Ä‘á»‹nh) ---
      - name: Gá»­i thÃ´ng bÃ¡o Merge vÃ o Main
        if: |
          github.event_name == 'push' &&
          github.ref_name == 'main' &&
          contains(github.event.head_commit.message, 'Merge pull request')
        uses: slackapi/slack-github-action@v1.26.0
        with:
          payload: '{"text": "âœ… ÄÃ£ gá»™p code vÃ o MAIN | NgÆ°á»i thá»±c hiá»‡n: ${{ github.actor }} | Ná»™i dung: ${{ github.event.head_commit.message }} | <${{ github.event.compare }}|Xem thay Ä‘á»•i>"}'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      # --- THÃ”NG BÃO PUSH LÃŠN CÃC NHÃNH PHá»¤ (Sá»­a láº¡i theo yÃªu cáº§u cá»§a báº¡n) ---
      - name: Gá»­i thÃ´ng bÃ¡o Push (NhÃ¡nh phá»¥)
        if: |
          github.event_name == 'push' &&
          github.ref_type == 'branch' &&
          github.ref_name != 'main'
        uses: slackapi/slack-github-action@v1.26.0
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          # Äá»‹nh nghÄ©a ná»™i dung tin nháº¯n nhiá»u dÃ²ng má»™t cÃ¡ch an toÃ n
          MESSAGE: |
            ğŸš€ `${{ github.actor }}` *Ä‘Ã£ PUSH code má»›i trÃªn nhÃ¡nh `${{ github.ref_name }}` vá»›i ná»™i dung commit: *`${{ github.event.head_commit.message }}`
            <${{ github.event.compare }}|Xem cÃ¡c thay Ä‘á»•i>
        with:
          # Sá»­ dá»¥ng toJson Ä‘á»ƒ Ä‘Ã³ng gÃ³i tin nháº¯n má»™t cÃ¡ch an toÃ n
          payload: ${{ toJson({ "text": env.MESSAGE }) }}

      # --- THÃ”NG BÃO Má» PULL REQUEST (Giá»¯ dáº¡ng Ä‘Æ¡n giáº£n, á»•n Ä‘á»‹nh) ---
      - name: Gá»­i thÃ´ng bÃ¡o Pull Request Ä‘Ã£ má»Ÿ
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        uses: slackapi/slack-github-action@v1.26.0
        with:
          payload: '{"text": "ğŸ“¥ PULL REQUEST Má»šI: `${{ github.event.pull_request.title }}` | NgÆ°á»i táº¡o: ${{ github.actor }} | Chi tiáº¿t: `${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}` | <${{ github.event.pull_request.html_url }}|Xem chi tiáº¿t>"}'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      # --- THÃ”NG BÃO ÄÃ“NG PULL REQUEST (KHÃ”NG MERGE) (Giá»¯ dáº¡ng Ä‘Æ¡n giáº£n, á»•n Ä‘á»‹nh) ---
      - name: Gá»­i thÃ´ng bÃ¡o Pull Request Ä‘Ã£ bá»‹ ÄÃ³ng
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == false
        uses: slackapi/slack-github-action@v1.26.0
        with:
          payload: '{"text": "âŒ ÄÃƒ ÄÃ“NG PULL REQUEST (KhÃ´ng merge): `${{ github.event.pull_request.title }}` | NgÆ°á»i thá»±c hiá»‡n: ${{ github.actor }} | <${{ github.event.pull_request.html_url }}|Xem chi tiáº¿t>"}'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}